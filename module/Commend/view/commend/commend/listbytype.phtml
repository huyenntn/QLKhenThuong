<?php
// module/Album/view/album/album/index.phtml:

$title = $type == 1 ? 'Thống kê Thi đua - Khen thưởng Cá nhân' : 'Thống kê Thi đua - Khen thưởng Tập thể';
$this->headTitle($title);
?>

<meta charset='utf-8'>
<div class="container">
    <h3><?php echo $title; ?></h3>
    <hr>
    <table style="margin-bottom: 30px; width: 100%; text-align: right">
        <tr>
            <td style="width:300px; display:inline-block;">
                <?php
                $form->setAttribute('action', '/commend/listbytype');
                $form->prepare();
                echo $this->form()->openTag($form);
                echo $this->formRow($form->get('selectsubaward'));
                echo $this->form()->closeTag();
                ?>
            </td>
            <td style="width:300px; display:inline-block;">
                <?php
                $form->setAttribute('action', '/commend/listbytype');
                $form->prepare();
                echo $this->form()->openTag($form);
                echo $this->formRow($form->get('selectYear'));
                echo $this->form()->closeTag();
                ?>
            </td>
            <td style="width:200px; display:inline-block; text-align: right;">
                <a class="btn btn-success"  href="<?php echo $this->url('commend', ['action' => 'add', 'type' => $type]); ?>">Thêm mới</a>
            </td>
        </tr>
    </table>

    <table class="table">
        <thead>
            <tr>
                <th><?php echo $type == 1 ? 'Họ tên' : 'Tập thể' ?></th>
                <th>Danh hiệu</th>
                <th>Danh Mục</th>
                <th>Đối tượng</th>
                <th>Năm</th>
                <th></th>
            </tr>
        </thead>
        <tbody id = "list"> 
        </tbody>
    </table>
    <?php
    echo $this->paginationControl(
            $this->paginator,
            'sliding',
            'commend/partials/paginator.phtml',
            [ 'type' => $type]);
    ?>
</div>
<script language = "javascript">
    $(document).ready(function () {
        $.ajax({
            url: '/commend/listbytype/'.$type,
            type: 'POST',
            dataType: 'json',
            async: true,
            success: function (data, status) {
                $('#list').html('');
                for (i = 0; i < data.length; i++) {
                    commend = data[i];
                    idvalue = commend['idCmd'];
                    urledit = "/commend/edit/".idvalue;
                    var e = $('<tr><td id = "idCmd" style="display: none"><td id = "nameS"></td><td id = "subAwardName"><td id = "awardName"></td><td id = "institute"></td><td id = "year"></td><td id = "btnedit"></td></tr>');
                    ten = commend['nameF'] + " " + commend['nameS'];
                    $('#idCmd', e).html(commend['idCmd']);
                    $('#nameS', e).html("<a href='/commend/detail/"+commend['institute']+"?id="+commend['idS']+"'>"+ten+"</a>");
                    $('#subAwardName', e).html(commend['subAwardName']);
                    $('#awardName', e).html(commend['awardName']);
                    commend['institute'] == 1 ? $('#institute', e).html('Cá nhân') : $('#institute', e).html('Tập thể');
                    $('#year', e).html(commend['year']);
                    $('#btnedit', e).html("<a class='btn btn-danger' href='/commend/edit?type=" + commend['institute'] + "&id=" + commend['idCmd'] + "'>Sửa</a> | <a class='btn btn-warning' href='/commend/delete?id=" + commend['idCmd'] + "'>Xóa</a>");
                    $('#list').append(e);
                }
                
            },
            error: function (xhr, textStatus, errorThrown) {
                alert('Ajax request failed.');
            }
        });
    });
</script>
<script type="text/javascript">
    $(document).ready(function () {
        $("#selectYear").change(function () {
            var yearselect = $(this).val();
            var idSub = $("#selectsubaward").val();
            if (yearselect !== "") {
                $.ajax({
                    url: '/commend/listbytype/'.$type,
                    type: 'POST',
                    data: {'idSub': idSub, 'year': yearselect},
                    dataType: 'json',
                    async: true,
                    success: function (data, status) {
                        $('#list').html('');
                        for (i = 0; i < data.length; i++) {
                            commend = data[i];
                            idvalue = commend['idCmd'];
                            urledit = "/commend/edit/".idvalue;
                            var e = $('<tr><td id = "idCmd" style="display: none"><td id = "nameS"></td><td id = "subAwardName"><td id = "awardName"></td><td id = "institute"></td><td id = "year"></td><td id = "btnedit"></td></tr>');
                            ten = "<a href='/commend/detail/"+commend['institute']+"?id="+commend['idS']+">"+commend['nameF'] + " " + commend['nameS']+"</a>";
                            $('#idCmd', e).html(commend['idCmd']);
                            $('#nameS', e).html(ten);
                            $('#subAwardName', e).html(commend['subAwardName']);
                            $('#awardName', e).html(commend['awardName']);
                            commend['institute'] == 1 ? $('#institute', e).html('Cá nhân') : $('#institute', e).html('Tập thể');
                            $('#year', e).html(commend['year']);
                            $('#btnedit', e).html("<a class='btn btn-danger' href='/commend/edit?type=" + commend['institute'] + "&id=" + commend['idCmd'] + "'>Sửa</a> | <a class='btn btn-warning' href='/commend/delete?id=" + commend['idCmd'] + "'>Xóa</a>");
                            $('#list').append(e);
                        }


                    },
                    error: function (xhr, textStatus, errorThrown) {
                        alert('Ajax request failed.');
                    }
                });
            }
        });

    });
</script>
<script type="text/javascript">
    $(document).ready(function () {
        $("#selectsubaward").change(function () {
            var yearselect = $("#selectYear").val();
            var idSub = $(this).val();
            if (idSub !== "") {
                $.ajax({
                    url: '/commend/listbytype/'.$type,
                    type: 'POST',
                    data: {'idSub': idSub, 'year': yearselect},
                    dataType: 'json',
                    async: true,
                    success: function (data, status) {
                        $('#list').html('');
                        for (i = 0; i < data.length; i++) {
                            commend = data[i];
                            idvalue = commend['idCmd'];
                            urledit = "/commend/edit/".idvalue;
                            var e = $('<tr><td id = "idCmd" style="display: none"><td id = "nameS"></td><td id = "subAwardName"><td id = "awardName"></td><td id = "institute"></td><td id = "year"></td><td id = "btnedit"></td></tr>');
                            ten = commend['nameF'] + " " + commend['nameS'];
                            $('#idCmd', e).html(commend['idCmd']);
                            $('#nameS', e).html(ten);
                            $('#subAwardName', e).html(commend['subAwardName']);
                            $('#awardName', e).html(commend['awardName']);
                            commend['institute'] == 1 ? $('#institute', e).html('Cá nhân') : $('#institute', e).html('Tập thể');
                            $('#year', e).html(commend['year']);
                            $('#btnedit', e).html("<a class='btn btn-danger' href='/commend/edit?type=" + commend['institute'] + "&id=" + commend['idCmd'] + "'>Sửa</a> | <a class='btn btn-warning' href='/commend/delete?id=" + commend['idCmd'] + "'>Xóa</a>");
                            $('#list').append(e);
                        }

                    },
                    error: function (xhr, textStatus, errorThrown) {
                        alert('Ajax request failed.');
                    }
                });
            }
        });

    });
</script>